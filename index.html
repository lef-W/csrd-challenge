<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CSRD Challenge - Finale</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .esg-active { filter: grayscale(0%); opacity: 1; transform: scale(1.1); border: 2px solid #4ade80; background: rgba(74, 222, 128, 0.1); }
        .esg-inactive { filter: grayscale(100%); opacity: 0.2; }
        .card { transition: all 0.3s ease; }
        .winner-glow { animation: glow 2s infinite alternate; }
        @keyframes glow {
            from { box-shadow: 0 0 10px #eab308; }
            to { box-shadow: 0 0 30px #eab308; }
        }
        .progress-label { font-size: 9px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; max-width: 60px; }
    </style>
</head>
<body class="bg-slate-950 text-white font-sans p-4 pb-40">

    <header class="max-w-7xl mx-auto mb-8">
        <div class="flex justify-between items-center">
            <div>
                <h1 class="text-4xl font-black text-green-500 tracking-tighter">CSRD CHALLENGE</h1>
                <p class="text-slate-400 text-sm uppercase tracking-widest">Sustainability Race</p>
            </div>
            <button onclick="resetGame()" class="text-xs bg-slate-800 hover:bg-red-900 text-slate-400 hover:text-white px-3 py-2 rounded border border-slate-700">
                NOUVELLE PARTIE
            </button>
        </div>
        
        <div id="winner-banner" class="hidden mt-6 bg-yellow-500 text-black p-4 rounded-xl text-center font-black text-2xl uppercase tracking-tighter animate-bounce">
            üèÜ <span id="winner-name"></span> A GAGN√â LA PARTIE ! üèÜ
        </div>
    </header>

    <main id="players-container" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 max-w-7xl mx-auto">
        </main>

    <div class="fixed bottom-0 left-0 right-0 bg-slate-900 border-t-2 border-slate-800 p-8 shadow-2xl z-50">
        <div class="max-w-7xl mx-auto">
            <div class="relative h-6 bg-slate-800 rounded-full border border-slate-700 flex items-center">
                <div class="absolute inset-0 flex justify-between px-4 text-[10px] text-slate-600 font-bold items-center pointer-events-none">
                    <span>START</span>
                    <span>MI-PARCOURS</span>
                    <span>GOAL (10)</span>
                </div>
                <div id="global-track"></div>
            </div>
        </div>
    </div>

    <script>
        let players = JSON.parse(localStorage.getItem('csrd-players')) || [
            { id: 1, name: "Entreprise 1", points: 0, industries: 0, e: false, s: false, g: false, color: "#ef4444" },
            { id: 2, name: "Entreprise 2", points: 0, industries: 0, e: false, s: false, g: false, color: "#3b82f6" },
            { id: 3, name: "Entreprise 3", points: 0, industries: 0, e: false, s: false, g: false, color: "#10b981" },
            { id: 4, name: "Entreprise 4", points: 0, industries: 0, e: false, s: false, g: false, color: "#f59e0b" }
        ];

        let isGameOver = false;

        // Fonction pour obtenir le nom du niveau en anglais
        function getLevelName(count) {
            if (count === 0) return "Start-up";
            if (count === 1) return "SME";
            return "Corporation";
        }

        function checkWinner() {
            const winner = players.find(p => p.points >= 10);
            if (winner) {
                isGameOver = true;
                document.getElementById('winner-banner').classList.remove('hidden');
                document.getElementById('winner-name').innerText = winner.name;
            } else {
                isGameOver = false;
                document.getElementById('winner-banner').classList.add('hidden');
            }
        }

        function save() {
            localStorage.setItem('csrd-players', JSON.stringify(players));
            render();
        }

        function render() {
            checkWinner();
            const container = document.getElementById('players-container');
            const track = document.getElementById('global-track');
            container.innerHTML = '';
            track.innerHTML = '';

            players.forEach(p => {
                const isWinner = p.points >= 10;
                
                // Card UI
                container.innerHTML += `
                    <div class="card bg-slate-900 border-2 ${isWinner ? 'border-yellow-500 winner-glow shadow-yellow-500/50' : 'border-slate-800'} rounded-2xl p-6 ${isGameOver && !isWinner ? 'opacity-50' : ''}">
                        <div class="mb-4">
                            <input type="text" value="${p.name}" 
                                onchange="updateName(${p.id}, this.value)"
                                ${isGameOver ? 'disabled' : ''}
                                class="bg-transparent border-b border-transparent hover:border-slate-600 outline-none font-bold text-xl w-full">
                            <div class="text-[10px] font-bold uppercase tracking-widest ${p.industries === 0 ? 'text-slate-500' : 'text-green-400'} mt-1">
                                ${getLevelName(p.industries)}
                            </div>
                        </div>

                        <div class="text-5xl font-black mb-6">${p.points} <span class="text-xs text-slate-500 uppercase">Pts</span></div>

                        <div class="flex gap-2 mb-6">
                            <button onclick="togglePillar(${p.id}, 'e')" ${isGameOver ? 'disabled' : ''} class="flex-1 py-2 rounded-lg ${p.e ? 'esg-active' : 'esg-inactive'}">üåø</button>
                            <button onclick="togglePillar(${p.id}, 's')" ${isGameOver ? 'disabled' : ''} class="flex-1 py-2 rounded-lg ${p.s ? 'esg-active' : 'esg-inactive'}">ü§ù</button>
                            <button onclick="togglePillar(${p.id}, 'g')" ${isGameOver ? 'disabled' : ''} class="flex-1 py-2 rounded-lg ${p.g ? 'esg-active' : 'esg-inactive'}">‚öñÔ∏è</button>
                        </div>

                        <div class="grid grid-cols-2 gap-2 mb-6">
                            <button onclick="addPoint(${p.id}, 2)" ${isGameOver ? 'disabled' : ''} class="bg-green-600 p-2 rounded font-bold text-[10px]">PHASE A (+2)</button>
                            <button onclick="addPoint(${p.id}, -1)" ${isGameOver ? 'disabled' : ''} class="bg-red-900 p-2 rounded font-bold text-[10px]">RISQUE (-1)</button>
                        </div>

                        <div class="flex justify-between items-center border-t border-slate-800 pt-4">
                            <span class="text-[10px] text-slate-500 uppercase font-bold">Usines: ${p.industries}</span>
                            <div class="flex gap-2">
                                <button onclick="updateIndustry(${p.id}, 1)" ${isGameOver ? 'disabled' : ''} class="w-6 h-6 bg-slate-800 rounded">+</button>
                                <button onclick="updateIndustry(${p.id}, -1)" ${isGameOver ? 'disabled' : ''} class="w-6 h-6 bg-slate-800 rounded">-</button>
                            </div>
                        </div>
                    </div>
                `;

                // Progress Bar Dot
                const position = Math.min((p.points / 10) * 100, 100);
                track.innerHTML += `
                    <div class="absolute transition-all duration-500 flex flex-col items-center" style="left: calc(${position}% - 20px); top: -25px; z-index: ${p.id}">
                        <div class="bg-white text-black text-[8px] font-bold px-1 rounded mb-1 shadow-md progress-label">
                            ${isWinner ? 'üèÜ WINNER' : p.name}
                        </div>
                        <div class="w-8 h-8 rounded-full border-2 border-white shadow-xl flex items-center justify-center font-black text-xs" style="background-color: ${p.color}">
                            ${p.points}
                        </div>
                    </div>
                `;
            });
        }

        function updateName(id, val) {
            players.find(p => p.id === id).name = val;
            save();
        }

        function addPoint(id, val) {
            if(isGameOver) return;
            const p = players.find(p => p.id === id);
            p.points = Math.max(0, p.points + val);
            save();
        }

        function updateIndustry(id, val) {
            if(isGameOver) return;
            const p = players.find(p => p.id === id);
            p.industries = Math.max(0, Math.min(2, p.industries + val));
            save();
        }

        function togglePillar(id, pillar) {
            if(isGameOver) return;
            const p = players.find(p => p.id === id);
            if (p.industries >= 1) {
                p[pillar] = !p[pillar];
                save();
            } else {
                alert("Niveau PME requis (1 usine) !");
            }
        }

        function resetGame() {
            if(confirm("Effacer les scores et recommencer ?")) {
                localStorage.clear();
                location.reload();
            }
        }

        render();
    </script>
</body>
</html>
